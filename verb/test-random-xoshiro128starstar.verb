\ Unittests for random-xoshiro128starstar
\
\ Copyright (c) 2022 Frank McIngvale, see LICENSE

: __modinit__
	"unittest" import
	"random-xoshiro128starstar" import
	;

: test-xoshiro128ss-seeding
	11 22 33 44 xoshiro128ss-seed
	[ 11 22 33 44 ] XOSHIRO128SS-STATE expect==
	;
	
\ seed is a list of 4 values (name with '*' so test runner doesn't run it by itself)
: *test-xoshiro128ss-case ( seed skip vals -- )
	"SEED:" . seed . CR
	"SKIP:" . skip . CR
	"VALS:" . vals . CR
	seed unmake drop xoshiro128ss-seed
	\ skip first values
	{ xoshiro128ss-next drop } skip repeat
	
	{ ( i ) 
		vals i get xoshiro128ss-next expect==
	} 0 1 vals length for-count
	;

: test-xoshiro128**
	\ list of:
	\	[ seedlist skip vals ]
	\
	\ test values generated by reference/xoshiro128starstar
	[
		[ [  272011914 1024715103   86178555 2213311456 ] 2937 [ 2031648795 3553998478 3146868635 3427008020  329412602 2496447099 1365180996   50175681 2797360117 3269076113 ] ]
		[ [ 4128913325 2789112053 2542547078 4003650979 ] 2937 [ 3812933648 1835742640  887458597 1970557951  916683341 1973627753 3215384121 3975949237 3010538942 3889197163 ] ]
		[ [ 3320410395 1737589964 2730127134 4025121456 ] 2937 [ 1221524896  745286829  262536410 3338466865 3494510263 1743921017 1850281243 3463802106 4238991513 1366677497 ] ]
		[ [ 1009041585  640321664  227863596 3216424659 ] 2937 [ 3028379685 2515481550 1986112679 3307280133 1413022936 3096389054 2876403022 3777735226  346054072 3272667900 ] ]
	]	
	{ ( P )
		P unmake drop *test-xoshiro128ss-case
	} for-each
	;
