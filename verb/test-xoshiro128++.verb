\ Unittests for xoshiro128++
\
\ Copyright (c) 2022 Frank McIngvale, see LICENSE

"unittest" import
"xoshiro128++" import

: test-xoshiro128pp-seeding
	11 22 33 44 xoshiro128pp-seed
	[ 11 22 33 44 ] XOSHIRO128PP-STATE expect==
	;
	
\ seed is a list of 4 values (name with '*' so test runner doesn't run it by itself)
: *test-xoshiro128pp-case ( seed skip vals -- )
	"SEED:" . seed . CR
	"SKIP:" . skip . CR
	"VALS:" . vals . CR
	seed unmake drop xoshiro128pp-seed
	\ skip first values
	{ xoshiro128pp-next drop } skip repeat
	
	::{ ( i ) 
		vals i get xoshiro128pp-next expect==
	} 0 1 vals length for-range
	;

: test-xoshiro128pp
	\ list of:
	\	[ seedlist skip vals ]
	\
	\ test values generated by reference/xoshiro128plusplus
	[
		[ [  272011914 1024715103   86178555 2213311456 ] 2937 [ 2385177022 2458260090 1327611212 3340449421 2154203555 1619429597 1061709321 1607655697 1930275559  700878322 ] ]
		[ [ 4128913325 2789112053 2542547078 4003650979 ] 2937 [ 2202261127 1706250527 1333946754  131615682 4160307846 3642568516 4072223321  952934959  258195348 1238812955 ] ]
		[ [ 3320410395 1737589964 2730127134 4025121456 ] 2937 [ 3046565086 3178260630 2372511888 1041841069 3918406431 4008833718 4113613862 3852416032 3450472930  479826910 ] ]
		[ [ 1009041585  640321664  227863596 3216424659 ] 2937 [ 2807136937 4202527007 4287486246 2220436088 3150721872  582691852 3039164032 4268054016 1232183370 2601915274 ] ]
	]
	
	::{ ( P )
		P unmake drop *test-xoshiro128pp-case
	} for-each
	;

(	
unittest-init

test-xoshiro128pp-seeding
test-xoshiro128pp

unittest-summary
)
